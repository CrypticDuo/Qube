<!doctype html>
<html ng-app="QubeApp">

<head>
	<script type="text/javascript" src='https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js'></script>
	<script src="https://code.jquery.com/ui/1.11.2/jquery-ui.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.2.16/angular.min.js"></script>
	<script src="/static/framework/pace/pace.min.js"></script>
	<script type="text/javascript" src="../static/framework/login-popup/js/jquery.leanModal.min.js"></script>
	<script src="/static/javascript/qube.js"></script>
	<script src="/static/javascript/view.js"></script>

	<link rel="stylesheet" href="https://code.jquery.com/ui/1.11.2/themes/smoothness/jquery-ui.css">
	<link rel="stylesheet" type="text/css" href="/static/css/main.css">
	<link rel="stylesheet" type="text/css" href="/static/css/view.css">
	<link type="text/css" rel="stylesheet" href="../static/framework/login-popup/css/style.css" />
	<link href='http://fonts.googleapis.com/css?family=Source+Sans+Pro:400,700|Open+Sans:300italic,400,300,700' rel='stylesheet' type='text/css'>
	<link rel="stylesheet" href="/static/framework/font-awesome-4.2.0/css/font-awesome.min.css">
    <script>
    var tag = document.createElement('script');
    tag.src = "https://www.youtube.com/iframe_api";

    var firstScriptTag = document.getElementsByTagName('script')[0];
    firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

    var player;
    var durationCounter = 0;
    
    function onYouTubeIframeAPIReady() {
        player = new YT.Player('player', {
            height: '190',
            width: $('.videolist').width(),
            videoId: '',
            playerVars: {
                'showinfo': 0,
                'autohide': 0,
                'controls': 0,
                'modestbranding': 1
            },
            events: {
                'onReady': onPlayerReady,
                'onStateChange': onPlayerStateChange
            }
        });
    }

    function onPlayerReady(event) {
        event.target.playVideo();
    }

    function onPlayerStateChange(event) {
    	if(event.data == YT.PlayerState.ENDED){
    		var $el = $('.userVideolist li.active');
    		var scope = angular.element($el).scope();
    		scope.$apply(function(){
    			scope.nextVideo();
    		});
    	}
    }

    function onVolumeChange(el, volume) {
		var scope = angular.element(el).scope();
		scope.$apply(function(){
			scope.changeVolume(volume);
    	});
    }

    $(document).ready(function() {
    	setInterval(function() {
    		console.log(player.getDuration());
    	},1000);

        var text = "";
        $('.userVideolist').on('mouseenter', 'span', function() {
            text = $(this).text();
            $(this).text("");
            $(this).append('<i style="color:#e52d4f;" class="fa fa-times"></i>');
            $(this).css("border-left","2px solid #e52d4f");
        });
        $('.userVideolist').on('mouseleave', 'span', function() {
            $(this).children().remove();
            $(this).text(text);
            $(this).css('border-left','0');
            text = "";
        });

		$(".volumeBar").slider();
		var $el = $(".volumeBar span");
		$el.css('left', 'calc(100% - 5px)');

		$(".progressBar").slider();
		var $p_el = $(".progressBar span");
		$p_el.css('left', '99.2%');

		$p_el.on('mousedown', function(){
			$(document).on('mousemove',function(){
				if(parseInt($p_el.css('left')) > 341){
					$p_el.css('left', '99.2%');
				}
			});
		});
		$el.on('mousedown', function(){
			var outerWidth = parseInt($('.volumeBar').css('width'));
			var prev = outerWidth;
			$(document).on('mousemove',function(){
				if(prev !== parseInt(parseInt($el.css('left'))/outerWidth * 100)){
					prev = parseInt(parseInt($el.css('left'))/outerWidth *100);
					onVolumeChange($el, prev);
					$(".volumeBar div.volumeLevel").css('width', parseInt($el.css('left')));
					if (prev == 0){
						$(".volume i").removeClass('fa-volume-up');
						$(".volume i").removeClass('fa-volume-down');
						$(".volume i").addClass('fa-volume-off');
					} else if(prev < 50){
						$(".volume i").removeClass('fa-volume-up');
						$(".volume i").addClass('fa-volume-down');
						$(".volume i").removeClass('fa-volume-off');
					} else if(prev > 50){
						$(".volume i").addClass('fa-volume-up');
						$(".volume i").removeClass('fa-volume-down');
						$(".volume i").removeClass('fa-volume-off');
					}
				}
			});
		});
		$(document).on('mouseup',function(){
			var outerWidth = parseInt($('.volumeBar').css('width'));
			var prev = outerWidth;
			if(prev !== parseInt(parseInt($el.css('left'))/outerWidth * 100)){
				prev = parseInt(parseInt($el.css('left'))/outerWidth *100);
				onVolumeChange($el, prev);
				$(".volumeBar div.volumeLevel").css('width', parseInt($el.css('left')));
			}
		});
    });
    </script>
</head>
<div id="QubePlaylist">
    <div ng-controller="QubeCont">
		<div id='cssmenu' class="topBar">
			<ul>
			   <li class="navi" ng-class="{active: layout == 'playlist'}" ng-click="layout = 'playlist'"><a class="category"><i class="fa fa-th-large"></i> Home</a></li>
			   <li class="navi" ng-class="{active: layout == 'youtube'}" ng-click="layout = 'youtube'"><a class="category"><i class="fa fa-youtube-play"></i> Search</a></li>
			   <li class="navi" ng-class="{active: layout == 'video'}" ng-click="layout = 'video'"><a class="category"><i class="fa fa-arrows-alt"></i> Expand</a></li>
			   <li class='has-sub category logout'><a>Account</a>
			      <ul>
			         <li><a href='#'>Empty</a></li>
							 <li><a href='./logout'>Logout</a></li>
			      </ul>
			   </li>
			</ul>
		</div><!-- END OF TOPBAR -->

		<div class="displayView">
			<div class="left">
				<div ng-show="layout == 'playlist'" class ="view playlist">
					<div class="playlistSearch">
						<input type="text" ng-model="searchString" placeholder="Search Playlist">
					</div>
					<ul class="userPlaylist">
						<li ng-repeat="playlist in playlists | searchFor:searchString" ng-class="{active: currentPlaylist.name == playlist.name}"
								ng-click="changePlaylist(playlist)" >
							<div class="playlistThumbnail">
								<img class="playlistThumbnail" src="{{ playlist.data[0].snippet.thumbnails.medium.url }}">
								<div id="playlistRemove" ng-click="removePlaylist(playlist)"><i class="fa fa-times"></i></div>
							</div>
							<div class="playlistDetail">
								<div class="title">{{playlist.name}}</div>
								<div class="duration">{{playlist.data.length}} songs - {{playlist.duration}}</div>
							</div>
						</li>
						<li style="margin: 0 3px;">
							<a id="addPlaylist" href="#addPlaylistModal">
								<div class="playlistThumbnail"><i class="fa fa-plus"></i></div>
								<div class="playlistDetail">
									<div class="title">Add a playlist!</div>
									<div class="duration">Click to add a playlist</div>
								</div>
							</a>
						</li>
					</ul>
				</div><!-- END OF PLAYLIST LAYOUT -->

				<div ng-show="layout == 'youtube'" class ="view youtube">
					<div class="youtubeSearchBar">
						<input ng-model="addVideoInput" ng-change="queryYoutube()" placeholder="Search for Youtube videos"></input>
					</div>
					<div class="video" ng-repeat="video in ytSearchResult" ng-click="addVideo(video)">
					  <div class="video-image">
					  	<img class="video-image" src="{{ video.thumbnail }}">
					  	<p class="video-duration">{{ video.contentDetails.duration }}</p>
					  </div>
					  <p class="video-title">{{ video.snippet.title }}</p>
						<ul>
						  <li class="video-author">by {{ video.author }}</li>
						  <li class="video-views"> {{ video.views }} views </li>
						</ul>
						<p class="video-description">{{ video.description }}</p>
					</div>
				</div><!-- END OF YOUTUBE LAYOUT -->

				<div ng-show="layout == 'video'" class ="view video">
					Video View mode!
				</div><!-- END OF VIDEO LAYOUT -->
			</div><!-- END OF LEFT VIEW -->
		 	<div class ="right">
				<div class ="videolist">
					<div class ="playlistHeader">
						<span> {{currentPlaylist.name}} </span>
					</div>
					<div class="player" style="position:relative; height:inherit; width:inherit;">
						<div id="player"></div>
							<div class="progressBar"><div class="progressLevel"></div></div>
							<div class="volume">
								<i class="fa fa-volume-up no-select" style="width:10px;"></i>
								<div class="volumeBar"><div class="volumeLevel"></div></div>
							</div>
							<div style="position:relative; margin:0 auto; width:100px;">
							<ul class="controllers" style="font-size:15px;">
								<li class="fa fa-backward no-select" ng-click="prevVideo()"></li>
								<li class="fa fa-play no-select" ng-click="togglePlayVideo()"></li>
								<li class="fa fa-forward no-select" ng-click="nextVideo()"></li>
							</ul>
						</div>
					</div>

					<ul class="userVideolist">
						<li ng-repeat="video in videos" ng-class="{active: video.id == currentPlaying}" ng-click="togglePlayVideo(video.id)" id="{{ video.id }}">
							<a>{{video.snippet.title}}</a>
							<span>{{video.contentDetails.duration}}</span>
						</li>
					</ul>
				</div>
			</div><!-- END OF RIGHT VIEW -->
		</div> <!-- END OF .displayView -->








		<div id="addPlaylistModal" class="popupContainer" style="display:none;">
			<header class="popupHeader">
				<span class="header_title">New Playlist</span>
				<span class="modal_close"><i class="fa fa-times"></i></span>
			</header>

			<section class="popupBody">
				<div class="addPlaylistModalBody">
					<input ng-model="addPlaylistInput"></input>
					<button ng-click="addPlaylist()" class="modal_close"><i class="fa fa-floppy-o"></i></button>
				</div>
			</section>
		</div>


	</div><!-- END OF ng-controller="QubeCont" -->
</div><!-- END OF #QubePlaylist -->

</body>

</html>
